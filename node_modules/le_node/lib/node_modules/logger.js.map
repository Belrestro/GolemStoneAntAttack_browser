{"version":3,"file":"logger.js","sources":["..\\src\\node_modules\\logger.js"],"sourcesContent":["\r\n// IMPORTS /////////////////////////////////////////////////////////////////////\r\n\r\nimport _                                    from 'lodash';\r\nimport * as defaults                        from 'defaults';\r\nimport * as levelUtil                       from 'levels';\r\nimport codependency                         from 'codependency';\r\nimport net                                  from 'net';\r\nimport text                                 from 'text';\r\nimport tls                                  from 'tls';\r\nimport urlUtil                              from 'url';\r\nimport { build }                            from 'serialize';\r\nimport { Writable }                         from 'stream';\r\nimport { BadOptionsError, LogentriesError } from 'error';\r\n\r\n// SYMBOLS /////////////////////////////////////////////////////////////////////\r\n\r\nconst $bufferFull     = Symbol('bufferFull property');\r\nconst $cannotConnect  = Symbol('cannotConnect property');\r\nconst $connection     = Symbol('connection property');\r\nconst $console        = Symbol('console property');\r\nconst $failedAttempts = Symbol('failedAttempts property');\r\nconst $flatten        = Symbol('flatten property');\r\nconst $flattenArrays  = Symbol('flattenArrays property');\r\nconst $getConnection  = Symbol('getConnection method');\r\nconst $host           = Symbol('host property');\r\nconst $json           = Symbol('json property');\r\nconst $levels         = Symbol('levels property');\r\nconst $Logger         = Symbol('Logger property (winston / bunyan)');\r\nconst $minLevel       = Symbol('minLevel property');\r\nconst $port           = Symbol('port property');\r\nconst $replacer       = Symbol('replacer property');\r\nconst $secure         = Symbol('secure property');\r\nconst $serialize      = Symbol('serialize method');\r\nconst $tempLevel      = Symbol('tempLevel property (winston)');\r\nconst $timeout        = Symbol('timeout property');\r\nconst $timestamp      = Symbol('timestamp property');\r\nconst $token          = Symbol('token property');\r\nconst $toLevel        = Symbol('toLevel method');\r\nconst $withLevel      = Symbol('withLevel property');\r\nconst $withStack      = Symbol('withStack property');\r\n\r\n// PATTERNS ////////////////////////////////////////////////////////////////////\r\n\r\nconst newline      = /\\n/g;\r\nconst tokenPattern = /[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}/;\r\n\r\n// UTIL ////////////////////////////////////////////////////////////////////////\r\n\r\nconst finalizeLogString = (log, token) =>\r\n\t`${ token } ${ log.toString().replace(newline, '\\u2028') }\\n`;\r\n\r\nconst getConsoleMethod = lvl => {\r\n\treturn lvl == 3 ? 'warn' : lvl > 3 ? 'error' : 'log';\r\n};\r\n\r\nconst getSafeProp = (log, prop) => {\r\n\twhile (prop in log) prop = '_' + prop;\r\n\treturn prop;\r\n};\r\n\r\nconst requirePeer = codependency.register(module);\r\n\r\n// DECORATORS //////////////////////////////////////////////////////////////////\r\n\r\nconst nonConfigurable = (target, name, descriptor) => {\r\n\tdescriptor.configurable = false;\r\n\tdescriptor.enumerable = true;\r\n\treturn descriptor;\r\n};\r\n\r\nconst unwritable = (target, name, descriptor) => {\r\n\tdescriptor.writable = false;\r\n\treturn descriptor;\r\n};\r\n\r\nconst enumerable = (target, name, descriptor) => {\r\n\tdescriptor.enumerable = true;\r\n\treturn descriptor;\r\n};\r\n\r\n// LOGGER //////////////////////////////////////////////////////////////////////\r\n\r\nexport default class Logger extends Writable {\r\n\tconstructor(opts) {\r\n\t\tsuper({\r\n\t\t\tobjectMode: true,\r\n\t\t\thighWaterMark: opts.bufferSize || defaults.bufferSize\r\n\t\t});\r\n\r\n\t\t// Sanity checks\r\n\r\n\t\tif (_.isUndefined(opts))\r\n\t\t\tthrow new BadOptionsError(opts, text.noOptions());\r\n\r\n\t\tif (!_.isObject(opts))\r\n\t\t\tthrow new BadOptionsError(opts, text.optionsNotObj(typeof opts));\r\n\r\n\t\tif (_.isUndefined(opts.token))\r\n\t\t\tthrow new BadOptionsError(opts, text.noToken());\r\n\r\n\t\tif (!_.isString(opts.token) || !tokenPattern.test(opts.token))\r\n\t\t\tthrow new BadOptionsError(opts, text.invalidToken(opts.token));\r\n\r\n\t\t// Log method aliases\r\n\r\n\t\tthis[$levels] = levelUtil.normalize(opts);\r\n\r\n\t\tfor (const lvlName of this.levels) {\r\n\t\t\tif (lvlName in this)\r\n\t\t\t\tthrow new BadOptionsError(opts, text.levelConflict(lvlName));\r\n\r\n\t\t\tObject.defineProperty(this, lvlName, {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\twritable: false,\r\n\t\t\t\tvalue() {\r\n\t\t\t\t\tthis.log.apply(this, [ lvlName, ...arguments ]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Other permanent options\r\n\r\n\t\tthis[$token] = opts.token;\r\n\r\n\t\t// Editable options\r\n\r\n\t\tthis.port =\r\n\t\t\topts.port || (opts.secure ? defaults.portSecure : defaults.port);\r\n\r\n\t\tthis.flatten       = opts.flatten;\r\n\t\tthis.flattenArrays =\r\n\t\t\t'flattenArrays' in opts ? opts.flattenArrays : opts.flatten;\r\n\r\n\t\tthis.json          = opts.json;\r\n\t\tthis.host          = opts.host;\r\n\t\tthis.console       = opts.console;\r\n\t\tthis.minLevel      = opts.minLevel;\r\n\t\tthis.replacer      = opts.replacer;\r\n\t\tthis.timeout       = opts.timeout;\r\n\t\tthis.timestamp     = opts.timestamp;\r\n\t\tthis.withLevel     = 'withLevel' in opts ? opts.withLevel : true;\r\n\t\tthis.withStack     = opts.withStack;\r\n\t\tthis[$secure]      = opts.secure;\r\n\r\n\t\t// Other\r\n\r\n\t\tthis[$cannotConnect]  = false;\r\n\t\tthis[$failedAttempts] = 0;\r\n\t}\r\n\r\n\t// Stream methods\r\n\r\n\t@unwritable\r\n\tasync _write(log, enc, cb) {\r\n\t\tlog = finalizeLogString(log, this[$token]);\r\n\r\n\t\ttry {\r\n\t\t\tconst conn = await this[$getConnection]();\r\n\t\t\tconn.write(log);\r\n\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit('error', err);\r\n\r\n\t\t} finally {\r\n\t\t\tcb();\r\n\t\t}\r\n\t}\r\n\r\n\t@unwritable\r\n\tend() {\r\n\t\tthis.on('connection drain', () => this.closeConnection());\r\n\t\tsuper.end(...arguments);\r\n\t}\r\n\r\n\t@unwritable\r\n\tsetDefaultEncoding() { /* no. */ }\r\n\r\n\t// Public methods\r\n\r\n\t@unwritable\r\n\t@enumerable\r\n\tlog(lvl, log) {\r\n\t\t// lvl is optional\r\n\t\tif (log === undefined) {\r\n\t\t\tlog = lvl;\r\n\t\t\tlvl = null;\r\n\t\t}\r\n\r\n\t\tlet lvlName;\r\n\r\n\t\tif (lvl || lvl === 0) {\r\n\t\t\t[ lvl, lvlName ] = this[$toLevel](lvl);\r\n\r\n\t\t\t// If lvl is present, it must be recognized\r\n\t\t\tif (!lvl && lvl !== 0) {\r\n\t\t\t\tthis.emit('error', new LogentriesError(text.unknownLevel(lvl)));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If lvl is below minLevel, it is dismissed\r\n\t\t\tif (lvl < this.minLevel)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If log is an array, it is treated as a collection of log events\r\n\t\tif (_.isArray(log)) {\r\n\t\t\tif (log.length)\r\n\t\t\t\tfor (const $log of log) this.log(lvl, $log);\r\n\t\t\telse\r\n\t\t\t\tthis.emit('error', new LogentriesError(text.noLogMessage()));\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If log is an object, it is serialized to string and may be augmented\r\n\t\t// with timestamp and level. For strings, these may be prepended.\r\n\r\n\t\tif (_.isObject(log)) {\r\n\r\n\t\t\tlet safeTime, safeLevel;\r\n\r\n\t\t\tif (this.timestamp) {\r\n\t\t\t\tsafeTime = getSafeProp(log, 'time');\r\n\t\t\t\tlog[safeTime] = new Date();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.withLevel && lvlName) {\r\n\t\t\t\tsafeLevel = getSafeProp(log, 'level');\r\n\t\t\t\tlog[safeLevel] = lvlName;\r\n\t\t\t}\r\n\r\n\t\t\tlog = this[$serialize](log);\r\n\r\n\t\t\tif (!log) {\r\n\t\t\t\tthis.emit('error', new LogentriesError(text.serializedEmpty()));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.console)\r\n\t\t\t\tconsole[getConsoleMethod(lvl)](JSON.parse(log));\r\n\r\n\t\t\tif (safeTime) delete log[safeTime];\r\n\t\t\tif (safeLevel) delete log[safeLevel];\r\n\r\n\t\t} else {\r\n\t\t\tif (_.isEmpty(log)) {\r\n\t\t\t\tthis.emit('error', new LogentriesError(text.noLogMessage()));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlog = [ log.toString() ];\r\n\r\n\t\t\tif (this.withLevel && lvlName)\r\n\t\t\t\tlog.unshift(lvlName);\r\n\r\n\t\t\tif (this.timestamp)\r\n\t\t\t\tlog.unshift((new Date()).toISOString());\r\n\r\n\t\t\tlog = log.join(' ');\r\n\r\n\t\t\tif (this.console)\r\n\t\t\t\tconsole[getConsoleMethod(lvl)](log);\r\n\t\t}\r\n\r\n\t\tif (this[$bufferFull]) {\r\n\t\t\tthis.emit('error', new LogentriesError(text.bufferFull(log)));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.emit('log', log);\r\n\r\n\t\tconst mayWriteFurther = this.write(log);\r\n\r\n\t\tif (!mayWriteFurther) {\r\n\t\t\tthis[$bufferFull] = true;\r\n\t\t\tthis.once('drain', () => this[$bufferFull] = false);\r\n\t\t}\r\n\t}\r\n\r\n\t@unwritable\r\n\t@enumerable\r\n\tcloseConnection() {\r\n\t\tif (!this[$connection]) return;\r\n\r\n\t\tthis[$connection].then(conn => conn.end());\r\n\t}\r\n\r\n\t// Private methods\r\n\r\n\t[$toLevel](val) {\r\n\t\tlet num;\r\n\r\n\t\tif (levelUtil.isNumberValid(val))\r\n\t\t\tnum = parseInt(parseInt(val)); // -0\r\n\t\telse\r\n\t\t\tnum = this[$levels].indexOf(val);\r\n\r\n\t\tconst name = this[$levels][num];\r\n\r\n\t\treturn name ? [ num, name ] : [];\r\n\t}\r\n\r\n\tasync [$getConnection](_resolve, _reject) {\r\n\t\t// The $connection property is a promise. On error, manual close, or\r\n\t\t// timeout, it deletes itself.\r\n\r\n\t\tif (this[$connection]) return this[$connection];\r\n\r\n\t\tif (this[$failedAttempts])\r\n\t\t\tawait new Promise(resolve => {\r\n\t\t\t\tsetTimeout(resolve, (this[$failedAttempts] ** 1.5) * 1000);\r\n\t\t\t});\r\n\r\n\t\tthis[$connection] = new Promise((resolve, reject) => {\r\n\t\t\tresolve = _resolve || resolve;\r\n\t\t\treject  = _reject || reject;\r\n\r\n\t\t\tif (this[$cannotConnect]) {\r\n\t\t\t\treject(new LogentriesError(text.cannotConnect()));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst opts = {\r\n\t\t\t\thost: this.host,\r\n\t\t\t\tport: this.port\r\n\t\t\t};\r\n\r\n\t\t\tlet connection;\r\n\t\t\tlet resolved = false;\r\n\r\n\t\t\tif (this.secure)\r\n\t\t\t\tconnection = tls.connect(opts, () => {\r\n\t\t\t\t\tif (!connection.authorized) {\r\n\t\t\t\t\t\tthis[$failedAttempts]++;\r\n\t\t\t\t\t\tconst errMsg = connection.authorizationError;\r\n\t\t\t\t\t\tthis.emit(new LogentriesError(text.authError(errMsg)));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\telse\r\n\t\t\t\tconnection = net.createConnection(opts);\r\n\r\n\t\t\tconnection.setTimeout(this.timeout);\r\n\r\n\t\t\t// Expose the connection’s drain event\r\n\t\t\tconnection.on('drain', () =>\r\n\t\t\t\tsetImmediate(() => this.emit('connection drain'))\r\n\t\t\t);\r\n\r\n\t\t\t// This is an inactivity timeout, not a connection timeout\r\n\t\t\tconnection.on('timeout', () => {\r\n\t\t\t\tconnection.end();\r\n\t\t\t\tdelete this[$connection];\r\n\t\t\t});\r\n\r\n\t\t\t// Error rejects the promise\r\n\t\t\tconnection.on('error', () => {\r\n\t\t\t\tconnection.destroy();\r\n\t\t\t\tdelete this[$connection];\r\n\r\n\t\t\t\t// If this error occurred before a connection was established,\r\n\t\t\t\t// we will try again up to a point.\r\n\t\t\t\tif (!resolved) {\r\n\t\t\t\t\tthis[$failedAttempts]++;\r\n\r\n\t\t\t\t\tif (this[$failedAttempts] >= defaults.maxFailedAttempts) {\r\n\t\t\t\t\t\tthis[$cannotConnect] = true;\r\n\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis[$cannotConnect] = false;\r\n\t\t\t\t\t\t}, defaults.retryTimeout);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis[$getConnection](resolve, reject);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Close will emit whether it was intended or error-caused:\r\n\t\t\tconnection.on('close', () => {\r\n\t\t\t\tdelete this[$connection];\r\n\r\n\t\t\t\tthis.emit('disconnected');\r\n\t\t\t});\r\n\r\n\t\t\t// This will probably never be triggered since the communication is\r\n\t\t\t// one-way, but just in case:\r\n\t\t\tconnection.on('end', () => {\r\n\t\t\t\tdelete this[$connection];\r\n\t\t\t});\r\n\r\n\t\t\t// Yay\r\n\t\t\tconnection.on('connect', () => {\r\n\t\t\t\tthis[$failedAttempts] = 0;\r\n\t\t\t\tresolved = true;\r\n\t\t\t\tresolve(connection);\r\n\r\n\t\t\t\tthis.emit('connected');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn this[$connection];\r\n\t}\r\n\r\n\t// Coercive settable options\r\n\r\n\t@nonConfigurable\r\n\tget console() { return this[$console]; }\r\n\tset console(val) { this[$console] = !!val; }\r\n\r\n\t@nonConfigurable\r\n\tget flatten() { return this[$flatten]; }\r\n\tset flatten(val) {\r\n\t\tthis[$flatten] = !!val;\r\n\t\tthis[$serialize] = build(this);\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget flattenArrays() { return this[$flattenArrays]; }\r\n\tset flattenArrays(val) {\r\n\t\tthis[$flattenArrays] = !!val;\r\n\t\tthis[$serialize] = build(this);\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget host() { return this[$host]; }\r\n\tset host(val) {\r\n\t\tif (!_.isString(val) || !val.length) {\r\n\t\t\tthis[$host] = defaults.host;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tval = val.replace(/^https?:\\/\\//, '');\r\n\r\n\t\tconst url = urlUtil.parse(`http://${ val }`);\r\n\r\n\t\tthis[$host] = url.hostname || defaults.host;\r\n\r\n\t\tif (url.port) this.port = url.port;\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget minLevel() { return this[$minLevel]; }\r\n\tset minLevel(val) {\r\n\t\tconst [ num ] = this[$toLevel](val);\r\n\r\n\t\tthis[$minLevel] = _.isNumber(num) ? num : 0;\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget port() { return this[$port]; }\r\n\tset port(val) {\r\n\t\tval = parseFloat(val);\r\n\t\tif (Number.isInteger(val) && _.inRange(val, 65536)) this[$port] = val;\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget replacer() { return this[$replacer]; }\r\n\tset replacer(val) {\r\n\t\tthis[$replacer] = _.isFunction(val) ? val : undefined;\r\n\t\tthis[$serialize] = build(this);\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget timeout() { return this[$timeout]; }\r\n\tset timeout(val) {\r\n\t\tif (Number.isInteger(val) && val >= 0)\r\n\t\t\tthis[$timeout] = parseInt(val);\r\n\r\n\t\tif (!_.isNumber(this[$timeout]))\r\n\t\t\tthis[$timeout] = defaults.timeout;\r\n\r\n\t\tthis.closeConnection();\r\n\t}\r\n\r\n\t@nonConfigurable\r\n\tget timestamp() { return this[$timestamp]; }\r\n\tset timestamp(val) { this[$timestamp] = !!val; }\r\n\r\n\t@nonConfigurable\r\n\tget withLevel() { return this[$withLevel]; }\r\n\tset withLevel(val) { this[$withLevel] = !!val; }\r\n\r\n\t@nonConfigurable\r\n\tget withStack() { return this[$withStack]; }\r\n\tset withStack(val) {\r\n\t\tthis[$withStack] = !!val;\r\n\t\tthis[$serialize] = build(this);\r\n\t}\r\n\r\n\t// Immutable properties\r\n\r\n\t@nonConfigurable\r\n\tget levels() { return this[$levels] && this[$levels].slice(); }\r\n\r\n\t@nonConfigurable\r\n\tget secure() { return this[$secure]; }\r\n\r\n\t// Exposed but externally immutable\r\n\r\n\t@nonConfigurable\r\n\tget serialize() { return this[$serialize]; }\r\n\r\n\t// Deprecated (to support migrants from le_node)\r\n\r\n\t@unwritable\r\n\tlevel(name) {\r\n\t\tconsole.warn(text.deprecatedLevelMethod());\r\n\t\tif (~this[$levels].indexOf(name)) this.minLevel = name;\r\n\t}\r\n\r\n\t@unwritable\r\n\twinston() {\r\n\t\tconsole.warn(text.deprecatedWinstonMethod());\r\n\t}\r\n\r\n\t// Static methods\r\n\r\n\t@unwritable\r\n\tstatic provisionWinston() {\r\n\t\tconst winston = requirePeer('winston');\r\n\r\n\t\tif (winston.transports.Logentries) return;\r\n\r\n\t\tconst Transport = winston.Transport;\r\n\r\n\t\tclass LogentriesTransport extends Transport {\r\n\t\t\tconstructor(opts) {\r\n\t\t\t\tsuper(opts);\r\n\t\t\t\tthis.json = opts.json;\r\n\r\n\t\t\t\topts = _.clone(opts || {});\r\n\r\n\t\t\t\topts.minLevel =\r\n\t\t\t\t\topts.minLevel || opts.level || this[$tempLevel] || 0;\r\n\r\n\t\t\t\topts.levels = opts.levels || winston.levels;\r\n\r\n\t\t\t\tdelete this[$tempLevel];\r\n\r\n\t\t\t\tthis[$Logger] = new Logger(opts);\r\n\r\n\t\t\t\tthis[$Logger].on('error', err => this.emit(err));\r\n\t\t\t}\r\n\r\n\t\t\t@unwritable\r\n\t\t\t@enumerable\r\n\t\t\tlog(lvl, msg, meta, cb) {\r\n\t\t\t\tif(this.json){\r\n\t\t\t\t\tvar message = {\r\n\t\t\t\t\t\tmessage: msg\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif(!_.isEmpty(meta))\r\n\t\t\t\t\t\tif(_.isObject(meta))\r\n\t\t\t\t\t\t\t_.defaults(message, meta);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tmessage.meta = meta;\r\n\r\n\r\n\t\t\t\t\tthis[$Logger].log(lvl, message);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!_.isEmpty(meta))\r\n\t\t\t\t\t\tif (_.isString(msg))\r\n\t\t\t\t\t\t\tmsg += ' ' + this[$Logger][$serialize](meta);\r\n\r\n\t\t\t\t\t\telse if (_.isObject(msg))\r\n\t\t\t\t\t\t\tmsg[getSafeProp(msg, 'meta')] = meta;\r\n\r\n\t\t\t\t\tthis[$Logger].log(lvl, msg);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetImmediate(cb.bind(null, null, true));\r\n\t\t\t}\r\n\r\n\t\t\t@nonConfigurable\r\n\t\t\tget name() { return 'logentries'; }\r\n\r\n\t\t\t@nonConfigurable\r\n\t\t\tget level() {\r\n\t\t\t\tconst [ , lvlName ] =\r\n\t\t\t\t\tthis[$Logger][$toLevel](this[$Logger].minLevel);\r\n\r\n\t\t\t\treturn lvlName;\r\n\t\t\t}\r\n\t\t\tset level(val) {\r\n\t\t\t\tif (!this[$Logger])\r\n\t\t\t\t\tthis[$tempLevel] = val;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis[$Logger].minLevel = val;\r\n\t\t\t}\r\n\r\n\t\t\t@nonConfigurable\r\n\t\t\tget levels() {\r\n\t\t\t\treturn this[$Logger].levels.reduce((acc, lvlName, lvlNum) => {\r\n\t\t\t\t\tacc[lvlName] = lvlNum;\r\n\t\t\t\t\treturn acc;\r\n\t\t\t\t}, {});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twinston.transports.Logentries = LogentriesTransport;\r\n\t}\r\n\r\n\tstatic bunyanStream(opts) {\r\n\t\tconst stream      = new BunyanStream(opts);\r\n\t\tconst [ , level ] = stream[$Logger][$toLevel](stream[$Logger].minLevel);\r\n\t\tconst type        = 'raw';\r\n\t\tconst name        = 'logentries';\r\n\r\n\t\t// Defer to Bunyan’s handling of minLevel\r\n\r\n\t\tstream[$Logger].minLevel = 0;\r\n\r\n\t\treturn { level, name, stream, type };\r\n\t}\r\n}\r\n\r\n// PROVISION WINSTON ///////////////////////////////////////////////////////////\r\n\r\nconst winston = requirePeer('winston', { optional: true });\r\n\r\nif (winston) Logger.provisionWinston();\r\n\r\n// BUNYAN STREAM ///////////////////////////////////////////////////////////////\r\n\r\nclass BunyanStream extends Writable {\r\n\tconstructor(opts) {\r\n\t\tsuper({\r\n\t\t\tobjectMode: true,\r\n\t\t\thighWaterMark: opts.bufferSize || defaults.bufferSize\r\n\t\t});\r\n\r\n\t\topts = _.clone(opts || {});\r\n\r\n\t\topts.timestamp = false;\r\n\t\topts.levels    = opts.levels || defaults.bunyanLevels;\r\n\r\n\t\tthis[$Logger] = new Logger(opts);\r\n\r\n\t\tthis[$Logger].on('error', err => this.emit(err));\r\n\t}\r\n\r\n\t@unwritable\r\n\t_write(log, enc, cb) {\r\n\t\tconst lvl = (log.level / 10) - 1;\r\n\r\n\t\tthis[$Logger].log(lvl, log);\r\n\r\n\t\tsetImmediate(cb);\r\n\t}\r\n}\r\n"],"names":[],"mappings":"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"}