{"version":3,"file":"Queue.js","sources":["../../../../src/queue/Queue.js"],"sourcesContent":["import { EventEmitter2 } from 'eventemitter2';\nimport { Promise } from 'sander';\n\nexport default class Queue extends EventEmitter2 {\n\tconstructor () {\n\t\tvar queue = this;\n\n\t\tsuper({ wildcard: true });\n\n\t\tqueue._tasks = [];\n\n\t\tqueue._run = () => {\n\t\t\tconst task = queue._tasks.shift();\n\n\t\t\tif ( !task ) {\n\t\t\t\tqueue._running = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttask.promise.then( runOnNextTick, runOnNextTick );\n\n\t\t\ttry {\n\t\t\t\ttask.fn( task.fulfil, task.reject );\n\t\t\t} catch ( err ) {\n\t\t\t\ttask.reject( err );\n\n\t\t\t\tqueue.emit( 'error', err );\n\t\t\t\trunOnNextTick();\n\t\t\t}\n\t\t};\n\n\t\tfunction runOnNextTick () {\n\t\t\tprocess.nextTick( queue._run );\n\t\t}\n\t}\n\n\tadd ( fn ) {\n\t\tlet task;\n\n\t\tconst promise = new Promise( ( fulfil, reject ) => {\n\t\t\ttask = { fn, fulfil, reject };\n\t\t});\n\n\t\ttask.promise = promise;\n\t\tthis._tasks.push( task );\n\n\t\tif ( !this._running ) {\n\t\t\tthis._running = true;\n\t\t\tthis._run();\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tabort () {\n\t\tthis._tasks = [];\n\t\tthis._running = false;\n\t}\n}\n"],"names":[],"mappings":";;;;;;;;;AAGA,IAAqB,QAArB,CAAA,UAAA,gBAAA;AACa,CAAb,SADqB,QACL;AADhB,EAAA,gBAAA,MAAqB;;AAEnB,EAAF,IAAM,QAAQ;;AAEZ,EAAF,eAAA,KAAA,MAAQ,EAAE,UAAU;;AAElB,EAAF,MAAQ,SAAS;;AAEf,EAAF,MAAQ,OAAO,YAAM;AAClB,GAAH,IAAS,OAAO,MAAM,OAAO;;AAE1B,GAAH,IAAQ,CAAC,MAAO;AACZ,IAAJ,MAAU,WAAW;AACjB,IAAJ;AACA;;AAEG,GAAH,KAAQ,QAAQ,KAAM,eAAe;;AAElC,GAAH,IAAO;AACH,IAAJ,KAAS,GAAI,KAAK,QAAQ,KAAK;AAC/B,KAAK,OAAQ,KAAM;AACf,IAAJ,KAAS,OAAQ;;AAEb,IAAJ,MAAU,KAAM,SAAS;AACrB,IAAJ;AACA;AACA;;AAEE,EAAF,SAAW,gBAAiB;AACzB,GAAH,QAAW,SAAU,MAAM;AAC3B;AACA;;AA/BA,CAAA,UAAqB,OAArB;;AAAqB,CAArB,MAAA,UAiCC,MAAI,SAjCL,IAiCO,IAAK;AACV,EAAF,IAAM,OAAN;;AAEE,EAAF,IAAQ,UAAU,kBAAW,CAAE,UAAE,QAAQ,QAAY;AAClD,GAAH,OAAU,EAAE,IAAA,IAAI,QAAA,QAAQ,QAAA;AACxB;;AAEE,EAAF,KAAO,UAAU;AACf,EAAF,KAAO,OAAO,KAAM;;AAElB,EAAF,IAAO,CAAC,KAAK,UAAW;AACrB,GAAH,KAAQ,WAAW;AAChB,GAAH,KAAQ;AACR;;AAEE,EAAF,OAAS;AACT;;AAjDqB,CAArB,MAAA,UAmDC,QAAM,SAnDP,QAmDU;AACR,EAAF,KAAO,SAAS;AACd,EAAF,KAAO,WAAW;AAClB;;AAtDA,CAAA,OAAqB;AAArB,8BAAgD;;qBAA3B"}