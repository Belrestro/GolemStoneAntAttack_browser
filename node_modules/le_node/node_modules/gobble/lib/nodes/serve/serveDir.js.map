{"version":3,"file":"serveDir.js","sources":["../../../../../../src/nodes/serve/serveDir.js"],"sourcesContent":["import { extname, resolve } from 'path';\nimport { statSync } from 'graceful-fs';\nimport { lookup } from 'mime';\nimport { exists, readdir } from 'sander';\nimport serveFile from './serveFile';\nimport dirTemplate from './templates/dir';\n\nexport default function serveDir ( filepath, request, response ) {\n\tconst index = resolve( filepath, 'index.html' );\n\n\treturn exists( index ).then( exists => {\n\t\tif ( exists ) {\n\t\t\treturn serveFile( index, request, response );\n\t\t}\n\n\t\treturn readdir( filepath ).then( files => {\n\t\t\tlet items = files.map( href => {\n\t\t\t\tconst stats = statSync( resolve( filepath, href ) );\n\t\t\t\tconst isDir = stats.isDirectory();\n\n\t\t\t\treturn {\n\t\t\t\t\tisDir,\n\t\t\t\t\thref,\n\t\t\t\t\ttype: isDir ? 'dir' : extname( href )\n\t\t\t\t};\n\t\t\t});\n\n\t\t\titems.sort( ( a, b ) => {\n\t\t\t\tif ( ( a.isDir && b.isDir ) || ( !a.isDir && !b.isDir ) ) {\n\t\t\t\t\treturn a.href < b.href ? 1 : -1;\n\t\t\t\t}\n\n\t\t\t\treturn a.isDir ? -1 : 1;\n\t\t\t});\n\n\t\t\tconst html = dirTemplate({\n\t\t\t\turl: request.url,\n\t\t\t\titems: items\n\t\t\t\t\t.map( item => `<li class=\"${item.type}\"><a href=\"${item.href}\">${item.href}</a></li>` )\n\t\t\t\t\t.join( '' )\n\t\t\t});\n\n\t\t\tresponse.statusCode = 200;\n\t\t\tresponse.setHeader( 'Content-Type', lookup( 'html' ) );\n\t\t\tresponse.setHeader( 'Content-Length', html.length );\n\n\t\t\tresponse.write( html );\n\t\t\tresponse.end();\n\t\t});\n\t});\n}\n"],"names":[],"mappings":";;;;;;;;;;;qBAIwB;AAGvB,SAAD,SAAA,UAAA,SACS,UADT;AAEG,CAAH,IAAA,oBAAA,CAAsB,UAAtB;;AAEI,CAAJ,oBAAA,CAAA,OAAA,KAAA,UAAA,QAAA;AACA,EAAA,IAAA,QAAA;AACA,GAAI,2BACK,CADT,OAAA,SAAA;AAEG;;AAEE,EAAL,qBAAA,CAAA,UAAA,KAAA,UAAA,OAAA;AACA,GAAA,IAAA,QAAA,MAAA,IAAA,UAAA,MAAA;AACA,IAAK,IAAL,4BAAA,aAAA,CAAA,UAAA;;;AAGA,IAAK,OAAL;;AAEC,KAAD,MAAA;AACE,KAAF,MAAA,QAAA,oBAAA,CAAA;AACE;AACC;;AAEH,GAAA,MAAA,KAAA,UAAA,GAAA,GAAA;AACA,IAAA,IAAA,EAAA,SAAA,EAAA,SAAA,CAAA,EAAA,SAAA,CAAA,EAAA,OAAA;;AAEE;;AAEF,IAAA,OAAA,EAAA,QAAA,CAAA,IAAA;;;;;;;;;;;;;;;;;;"}